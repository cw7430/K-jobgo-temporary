<!-- src/main/resources/templates/admin/applyList.html -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}" />
  <meta name="page-size" th:content="${pageObj != null ? pageObj.size : 10}" />

  <title>(주)한국경영지원사업단 | 구직 신청 관리</title>

  <!-- Favicon -->
  <link rel="icon" href="https://k-jobgo-profile-photos-seoul.s3.ap-northeast-2.amazonaws.com/img/favicon.png" />

  <!-- CSS (공통 → 상세) -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/layout.css}" />
  <link rel="stylesheet" th:href="@{/css/toggle.css}" />
  <link rel="stylesheet" th:href="@{/css/main.css}" />
  <link rel="stylesheet" th:href="@{/css/login.css}" />
  <link rel="stylesheet" th:href="@{/css/erp-layout.css}" />
  <link rel="stylesheet" th:href="@{/css/applyList.css}" />
</head>

<body class="all-page"
      th:attr="data-is-admin=${isAdmin},
               data-authority=${authorityId},
               data-admin-name=${adminName},
               data-super=${isSuper},
               data-env=${@environment.getActiveProfiles()[0]}">

  <!-- 헤더 (클라이언트/관리자 공용 선택) -->
  <div th:replace="${isClient} ? ~{fragments/clientHeader :: siteHeader} : ~{fragments/header :: siteHeader}"></div>

  <!-- 상단 로고 (visa 페이지와 동일 배치) -->
  <div class="center-kjobgo-logo">
    <a th:href="@{/}">
      <img src="/img/k-jobgo_company.png" alt="K-jobgo | 외국인 인재 매칭 플랫폼" class="k-jobgologo" />
    </a>
  </div>

  <div class="wrap">
    <h1>구직신청 확인 페이지</h1>

    <!-- 🔎 검색 폼 (가운데 정렬, 동작은 미정) -->
    <form class="search-bar" method="get" th:action="@{/admin/applyEmp/list}">
	  <!-- 상태 버킷: 클래스 유지 -->
		<select name="bucket" class="sel" id="statusBucket" style="width:180px">
		  <option value="" th:selected="${filterBucket == null or filterBucket == ''}">전체</option>
		  <option value="IN_PROGRESS" th:selected="${filterBucket == 'IN_PROGRESS'}">진행중</option>
		  <option value="COMPLETED" th:selected="${filterBucket == 'COMPLETED'}">완료</option>
		  <option value="CANCELLED_OR_REJECTED" th:selected="${filterBucket == 'CANCELLED_OR_REJECTED'}">취소·반려</option>
		</select>
	
	  <!-- 기간/키워드: 클래스 유지 -->
	  <input class="inp" type="date" name="from" th:value="${param.from}" style="width:160px" />
	  <span style="opacity:.6">~</span>
	  <input class="inp" type="date" name="to" th:value="${param.to}" style="width:160px" />
	
	  <input class="inp" type="text" name="q"
	         placeholder="업체/담당자/국적/직종 등 검색"
	         th:value="${param.q}" style="width:280px" />
	
	  <button class="btn btn--primary" type="submit">검색</button>
	  
	  <!-- ✅ 전체보기(필터 초기화) 버튼 -->
	  <button type="button" class="btn" id="btnReset" style="margin-left:8px;">전체보기</button>
	
	  <!-- 안내문: 기존 .hint 활용 -->
		<div id="bucketHint" class="hint" style="margin-left:4px" th:switch="${filterBucket}">
		  <span th:case="'IN_PROGRESS'">‘진행중’에는 <b>접수됨·검토중·진행중·보류</b>가 포함됩니다.</span>
		  <span th:case="'COMPLETED'">‘완료’에는 <b>완료</b>만 포함됩니다.</span>
		  <span th:case="'CANCELLED_OR_REJECTED'">‘취소·반려’에는 <b>취소·반려</b>가 포함됩니다.</span>
		  <span th:case="*">상태를 선택하거나 키워드를 입력해 검색하세요.</span>
		</div>	
    </form>

    <!-- ✅ 테이블 프래그먼트 삽입 (visa와 동일한 사용 패턴) -->
    <div th:replace="~{fragments/applyFragments :: applyEmpTable(${applyList}, ${true}, ${filterStatus}, ${pageObj})}"></div>

    <!-- 📄 페이징 (visa 페이지와 동일한 중앙 하단 배치) -->
    <div class="pagination" th:if="${pageObj != null and pageObj.totalPages > 0}"
         style="display:flex; justify-content:center; margin:18px 0 6px;">
      <ul style="display:flex; gap:6px; list-style:none; padding:0; margin:0;">
        <!-- 이전 -->
        <li th:classappend="${pageObj.first} ? 'disabled'">
          <a th:if="${!pageObj.first}"
             th:href="@{/admin/applyEmp/list(page=${pageObj.number-1}, size=${pageObj.size}, q=${param.q}, bucket=${param.bucket}, from=${param.from}, to=${param.to})}">« 이전</a>
          <span th:if="${pageObj.first}">« 이전</span>
        </li>

        <!-- 번호 -->
        <li th:each="i : ${#numbers.sequence(0, pageObj.totalPages-1)}"
            th:classappend="${i == pageObj.number} ? 'active'">
          <a th:href="@{/admin/applyEmp/list(page=${i}, size=${pageObj.size}, q=${param.q}, bucket=${param.bucket}, from=${param.from}, to=${param.to})}"
             th:text="${i+1}">1</a>
        </li>

        <!-- 다음 -->
        <li th:classappend="${pageObj.last} ? 'disabled'">
          <a th:if="${!pageObj.last}"
             th:href="@{/admin/applyEmp/list(page=${pageObj.number+1}, size=${pageObj.size}, q=${param.q}, bucket=${param.bucket}, from=${param.from}, to=${param.to})}">다음 »</a>
          <span th:if="${pageObj.last}">다음 »</span>
        </li>
      </ul>
    </div>
  </div>

  <footer class="foot-var">
    <div>
      <p>
        <span>(주)한국경영지원사업단&nbsp; 대표이사 : 이준희 <span class="divider">|</span> 사업자등록번호 : 887-81-00124</span><br>
        본사_경기도 김포시 김포한강4로 125 월드타워 705호 <span class="divider">|</span> 본부_경기도 광명시 일직로 43 GIDC A1706호<br>
        국내지사_김해지사, 대구지사, 천안지사, 광주지사, 원주지사 <span class="divider">|</span> 해외지사_베트남, 필리핀, 인도네시아, 인도, 몽골, 네팔, 우즈베키스탄<br>
        유료직업소개업 등록번호 : 제2025-4090515-14-5-00012호 <span class="divider">|</span>
        Tel_ 031-983-0942 <span class="divider">|</span>  Fax_ 031-624-1540  <span class="divider">|</span> Email_ k-jobgo@naver.com<br>
        ⓒ 2025 K-jobgo. All rights reserved.
      </p>
    </div>
  </footer>

<script th:src="@{/js/common.js}"></script>
<script th:src="@{/js/login.js}"></script>
<script th:src="@{/js/applyList.js}"></script> <!-- ✅ 추가 -->

</body>
</html>
